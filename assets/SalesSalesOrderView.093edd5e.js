var ne=Object.defineProperty;var C=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var O=(r,u,d)=>u in r?ne(r,u,{enumerable:!0,configurable:!0,writable:!0,value:d}):r[u]=d,L=(r,u)=>{for(var d in u||(u={}))A.call(u,d)&&O(r,d,u[d]);if(C)for(var d of C(u))E.call(u,d)&&O(r,d,u[d]);return r};var Q=(r,u)=>{var d={};for(var c in r)A.call(r,c)&&u.indexOf(c)<0&&(d[c]=r[c]);if(r!=null&&C)for(var c of C(r))u.indexOf(c)<0&&E.call(r,c)&&(d[c]=r[c]);return d};import{r as oe,e as U,f as p,L as ae,M as ie,u as s,o as b,g as F,h as t,w as a,F as P,W as T,c as G,i as x,t as k,l as V,T as re,S as w,N as de,U as ue,s as ce,p as me,k as pe}from"./vendor.2c85bd1e.js";import{u as _e}from"./merchandise.276d617b.js";import{u as fe}from"./client.cb3ec19c.js";import{_ as ge,N as W}from"./index.917c111f.js";import{u as be}from"./sale.598e92ad.js";import"./index.cefb1522.js";import"./interceptor.bb9bfcba.js";const ve={code:[{required:!0,message:"Please, input the sales code",trigger:"blur"},{min:2,message:"Must have at least 2 characters",trigger:"blur"}],gross_value:[{required:!0,message:"Please, input the gross value",trigger:"blur"},{type:"number",min:1,message:"Must be greater than zero",trigger:"blur"}],discount:[{required:!0,message:"Please, input the discount",trigger:"blur"},{type:"number",min:0,message:"Must be greater or equal zero",trigger:"blur"}],net_value:[{required:!0,message:"Please, input the net value",trigger:"blur"},{type:"number",min:1,message:"Must be greater than zero",trigger:"blur"}]};const j=r=>(me("data-v-233b392c"),r=r(),pe(),r),he=j(()=>x("h4",null,"Merchandises",-1)),Ve=V("Add Sold Merchandise"),Se=j(()=>x("br",null,null,-1)),Me=V("Submit"),ye={emits:["submit"],setup(r,{emit:u}){const d=_e(),c=fe(),g={code:"",description:"",gross_value:0,discount:0,net_value:0,merchandises:[]},S=oe(),i=U(g),M=U(ve),$={id:null,client_id:null,retail_price:0,quantity:1},o=U({isLoading:!0,soldMerchandise:L({},$),merchandiseList:[],clientList:[]});Promise.all([d.fetchMerchandiseList(),c.fetchClientList()]).then(()=>{o.isLoading=!1,o.merchandiseList=d.merchandises,o.clientList=c.clientsFixed});const q=()=>{const{gross_value:n,discount:e}=i;n<e?i.discount=n:i.net_value=n-e},H=n=>{const e=o.merchandiseList.find(_=>_.id===n);o.soldMerchandise.retail_price=parseFloat(e==null?void 0:e.retail_price)},N=()=>{if(!o.soldMerchandise.id||!o.soldMerchandise.client_id)return;const m=o.soldMerchandise,{retail_price:n,quantity:e}=m,_=Q(m,["retail_price","quantity"]);i.gross_value+=n*e,i.merchandises.push(L({retail_price:n,quantity:e},_)),o.soldMerchandise=L({},$),q()},J=n=>o.merchandiseList.find(e=>e.id===n),K=n=>o.clientList.find(e=>e.id===n),R=n=>{o.soldMerchandise.id&&o.soldMerchandise.client_id&&N(),D(n),o.soldMerchandise=n},D=n=>{i.merchandises=i.merchandises.filter(({client_id:e,id:_})=>n.id!==_&&n.client_id!==e),i.gross_value-=n.retail_price*n.quantity,q()},X=n=>{!n||n.validate(e=>{if(!e)return!1;const _=()=>{n.resetFields(),i.merchandises=[]};u("submit",{model:n.model,clearForm:_})})};return(n,e)=>{const _=p("el-input"),m=p("el-form-item"),v=p("el-input-number"),Y=p("el-divider"),Z=p("el-tag"),I=p("el-option"),B=p("el-select"),y=p("el-button"),h=p("el-table-column"),ee=p("el-button-group"),le=p("el-table"),te=p("el-form"),se=ae("loading");return ie((b(),F("div",null,[t(te,{"label-width":"150px",ref_key:"createSalesFormRef",ref:S,model:s(i)},{default:a(()=>[t(m,{label:"Code",prop:"code",rules:s(M).code},{default:a(()=>[t(_,{modelValue:s(i).code,"onUpdate:modelValue":e[0]||(e[0]=l=>s(i).code=l),style:{width:"100px"}},null,8,["modelValue"])]),_:1},8,["rules"]),t(m,{label:"Gross Value",prop:"gross_value",rules:s(M).gross_value},{default:a(()=>[t(v,{disabled:"",class:"small-form-input",modelValue:s(i).gross_value,"onUpdate:modelValue":e[1]||(e[1]=l=>s(i).gross_value=l),precision:2,min:0},null,8,["modelValue"])]),_:1},8,["rules"]),t(m,{label:"Discount",prop:"discount",rules:s(M).discount},{default:a(()=>[t(v,{class:"small-form-input",modelValue:s(i).discount,"onUpdate:modelValue":e[2]||(e[2]=l=>s(i).discount=l),precision:2,min:0,max:s(i).gross_value,onChange:e[3]||(e[3]=l=>q())},null,8,["modelValue","max"])]),_:1},8,["rules"]),t(m,{label:"Net Value",prop:"net_value",rules:s(M).net_value},{default:a(()=>[t(v,{disabled:"",class:"small-form-input",modelValue:s(i).net_value,"onUpdate:modelValue":e[4]||(e[4]=l=>s(i).net_value=l),precision:2,min:0},null,8,["modelValue"])]),_:1},8,["rules"]),t(m,{label:"Description",prop:"description"},{default:a(()=>[t(_,{modelValue:s(i).description,"onUpdate:modelValue":e[5]||(e[5]=l=>s(i).description=l)},null,8,["modelValue"])]),_:1}),t(Y),he,t(m,{label:"Product"},{default:a(()=>[t(B,{placeholder:"Select a product",modelValue:s(o).soldMerchandise.id,"onUpdate:modelValue":e[6]||(e[6]=l=>s(o).soldMerchandise.id=l),onChange:e[7]||(e[7]=l=>H(l))},{default:a(()=>[(b(!0),F(P,null,T(s(o).merchandiseList,l=>(b(),G(I,{key:l.id,label:`${l.product.name} (${l.product.name})`,value:l.id},{default:a(()=>[x("span",null,k(l.product.name),1),t(Z,{class:"select-option-icon-position"},{default:a(()=>[V(k(l.product.name),1)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"Client"},{default:a(()=>[t(B,{placeholder:"Select a client",modelValue:s(o).soldMerchandise.client_id,"onUpdate:modelValue":e[8]||(e[8]=l=>s(o).soldMerchandise.client_id=l),modelModifiers:{number:!0}},{default:a(()=>[(b(!0),F(P,null,T(s(o).clientList,l=>(b(),G(I,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"Retail Price"},{default:a(()=>[t(v,{disabled:"",class:"small-form-input",modelValue:s(o).soldMerchandise.retail_price,"onUpdate:modelValue":e[9]||(e[9]=l=>s(o).soldMerchandise.retail_price=l),precision:2,min:0},null,8,["modelValue"])]),_:1}),t(m,{label:"Quantity"},{default:a(()=>[t(v,{class:"small-form-input",modelValue:s(o).soldMerchandise.quantity,"onUpdate:modelValue":e[10]||(e[10]=l=>s(o).soldMerchandise.quantity=l),min:1},null,8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(y,{icon:s(re),onClick:e[11]||(e[11]=w(l=>N(),["prevent"]))},{default:a(()=>[Ve]),_:1},8,["icon"])]),_:1}),t(le,{"row-key":"id",data:s(i).merchandises},{default:a(()=>[t(h,{label:"Product"},{default:a(l=>{var f,z;return[V(k((z=(f=J(l.row.id))==null?void 0:f.product)==null?void 0:z.name),1)]}),_:1}),t(h,{label:"Client"},{default:a(l=>{var f;return[V(k((f=K(l.row.client_id))==null?void 0:f.name),1)]}),_:1}),t(h,{prop:"retail_price",label:"Sales Price"}),t(h,{prop:"quantity",label:"Quantity"}),t(h,{width:"120"},{default:a(l=>[t(ee,{class:"ml-4 align-content-right"},{default:a(()=>[t(y,{icon:s(de),onClick:w(f=>R(l.row),["prevent"])},null,8,["icon","onClick"]),t(y,{type:"danger",icon:s(ue),onClick:w(f=>D(l.row),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),Se,t(m,null,{default:a(()=>[t(y,{type:"primary",icon:s(ce),onClick:e[12]||(e[12]=l=>X(S.value))},{default:a(()=>[Me]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])),[[se,s(o).isLoading]])}}};var Ce=ge(ye,[["__scopeId","data-v-233b392c"]]);const Le=x("h2",null,"Create Sales Order",-1),Ne={setup(r){const u=be(),d=({model:c,clearForm:g})=>{u.createSale(c).then(()=>{W.notifySuccess("A sales order was created"),g()}).catch(()=>W.notifyError("Could not create the sales order"))};return(c,g)=>(b(),F(P,null,[Le,t(Ce,{onSubmit:g[0]||(g[0]=S=>d(S))})],64))}};export{Ne as default};
