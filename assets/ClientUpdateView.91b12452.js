var _=Object.defineProperty;var l=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var h=(n,i,e)=>i in n?_(n,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[i]=e,v=(n,i)=>{for(var e in i||(i={}))C.call(i,e)&&h(n,e,i[e]);if(l)for(var e of l(i))g.call(i,e)&&h(n,e,i[e]);return n};var S=(n,i)=>{var e={};for(var t in n)C.call(n,t)&&i.indexOf(t)<0&&(e[t]=n[t]);if(n!=null&&l)for(var t of l(n))i.indexOf(t)<0&&g.call(n,t)&&(e[t]=n[t]);return e};import{S as b}from"./SalesClientForm.10fdf757.js";import{N as r,r as y}from"./index.917c111f.js";import{u as k}from"./client.cb3ec19c.js";import{e as F,L as B,o as u,g as m,M as E,u as p,h as V,Q as x,F as D,i as I}from"./vendor.2c85bd1e.js";import"./index.cefb1522.js";import"./interceptor.bb9bfcba.js";const M=I("h2",null,"Update client",-1),w={key:0},q={props:{clientId:Number},setup(n){const i=n,e=k(),t=F({client:null,isLoading:!0});e.fetchOneClient(i.clientId).then(()=>{t.isLoading=!1,t.client=e.clientWithRelationships});const L=f=>{var o=f,{contacts:c}=o,a=S(o,["contacts"]);t.isLoading=!0,e.updateClient(v({},a)).then(d=>{if(r.notifySuccess("Client updated"),c.length===0){y.push({path:"/dashboard/sales-management/clients"});return}const N=c.map(s=>s.deletionMarked===!0?e.deleteClientContact(d,s.id):s.id?e.updateClientContact(d,s):e.createClientContact(d,s));Promise.all(N).then(()=>{r.notifySuccess("Client contact updated"),y.push({path:"/dashboard/sales-management/clients"})}).catch(()=>r.notifyError("Could not update client contacts")).finally(()=>t.isLoading=!1)}).catch(()=>r.notifyError("Could not update client")).finally(()=>t.isLoading=!1)};return(c,a)=>{const f=B("loading");return u(),m(D,null,[M,E((u(),m("div",null,[p(t).client!==null?(u(),m("div",w,[V(b,{client:p(t).client,onSubmit:a[0]||(a[0]=o=>L(o))},null,8,["client"])])):x("",!0)])),[[f,p(t).isLoading]])],64)}}};export{q as default};
